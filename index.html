<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bistro Manager Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        body { touch-action: manipulation; -webkit-user-select: none; }
        .kanban-column { min-height: 120px; padding-bottom: 60px; }
        .guest-card { 
            cursor: grab; 
            margin-bottom: 12px; 
            border-radius: 16px; 
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            transition: transform 0.2s;
        }
        .table-box { min-height: 160px; border-width: 3px; border-style: dashed; }
        
        /* Status Colors - Bold & Clear */
        .status-pending { background-color: #ffffff; border-left: 12px solid #cbd5e1; color: #1e293b; }
        .status-arrived { background-color: #fffbeb; border-left: 12px solid #f59e0b; color: #92400e; }
        .status-seated { background-color: #f0fdf4; border-left: 12px solid #22c55e; color: #166534; }

        @media print {
            .no-print { display: none !important; }
            #printArea { display: block !important; visibility: visible; }
        }
    </style>
</head>
<body class="bg-slate-100 p-4 font-sans text-slate-900">

    <div class="max-w-[1500px] mx-auto no-print">
        <header class="flex justify-between items-center mb-6 bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
            <div class="flex items-center gap-8">
                <div>
                    <h1 class="text-3xl font-black tracking-tighter italic">FLOOR OPS</h1>
                    <div id="totalCovers" class="text-sm font-bold text-blue-600 uppercase tracking-widest">Total: 0 Guests</div>
                </div>
                <input type="date" id="datePicker" class="text-xl border-2 border-slate-100 p-3 rounded-2xl font-black text-slate-700 bg-slate-50 outline-none">
            </div>
            
            <div class="flex items-center gap-4">
                <button onclick="window.print()" class="bg-slate-800 text-white px-6 py-4 rounded-2xl font-bold">Print List</button>
                <button onclick="openModal()" class="bg-blue-600 text-white px-10 py-5 rounded-2xl font-black text-xl shadow-lg shadow-blue-200">+ BOOKING</button>
            </div>
        </header>

        <div class="grid grid-cols-12 gap-6">
            <div class="col-span-3 space-y-4">
                <div class="text-center font-black text-blue-600 bg-blue-100 py-3 rounded-2xl">ZONE A</div>
                <div id="container-A1" class="table-box bg-white p-4 rounded-3xl"><div class="font-black text-slate-400 mb-2">A1</div><div id="A1" class="kanban-column"></div></div>
                <div id="container-A2" class="table-box bg-white p-4 rounded-3xl"><div class="font-black text-slate-400 mb-2">A2</div><div id="A2" class="kanban-column"></div></div>
                <div id="container-A3" class="table-box bg-white p-4 rounded-3xl"><div class="font-black text-slate-400 mb-2">A3</div><div id="A3" class="kanban-column"></div></div>
                <div class="h-1 bg-slate-300 mx-10 my-2"></div>
                <div id="container-A6" class="table-box bg-white p-4 rounded-3xl"><div class="font-black text-slate-400 mb-2">A6</div><div id="A6" class="kanban-column"></div></div>
                <div id="container-A7" class="table-box bg-white p-4 rounded-3xl"><div class="font-black text-slate-400 mb-2">A7</div><div id="A7" class="kanban-column"></div></div>
                <div id="container-A8" class="table-box bg-white p-4 rounded-3xl"><div class="font-black text-slate-400 mb-2">A8</div><div id="A8" class="kanban-column"></div></div>
            </div>

            <div class="col-span-4 bg-slate-300/50 p-6 rounded-[2.5rem] border-2 border-slate-300 border-dashed">
                <h2 class="font-black text-slate-500 mb-6 uppercase text-center tracking-tighter">Waiting / Unassigned</h2>
                <div id="unassigned" class="kanban-column min-h-[800px]"></div>
                <button onclick="clearDay()" class="w-full mt-4 text-xs text-slate-400 font-bold uppercase underline">Clear All Data</button>
            </div>

            <div class="col-span-5 space-y-4">
                <div class="text-center font-black text-emerald-600 bg-emerald-100 py-3 rounded-2xl">ZONE B</div>
                <div class="grid grid-cols-2 gap-4">
                    <div id="container-B1" class="table-box bg-white p-4 rounded-3xl"><div class="font-black text-slate-400 mb-2">B1</div><div id="B1" class="kanban-column"></div></div>
                    <div id="container-B2" class="table-box bg-white p-4 rounded-3xl"><div class="font-black text-slate-400 mb-2">B2</div><div id="B2" class="kanban-column"></div></div>
                    <div id="container-B3" class="table-box bg-white p-4 rounded-3xl"><div class="font-black text-slate-400 mb-2">B3</div><div id="B3" class="kanban-column"></div></div>
                    <div id="container-B4" class="table-box bg-white p-4 rounded-3xl"><div class="font-black text-slate-400 mb-2">B4</div><div id="B4" class="kanban-column"></div></div>
                    <div id="container-B5" class="table-box col-span-2 bg-white p-4 rounded-3xl"><div class="font-black text-slate-400 mb-2">B5 (Large)</div><div id="B5" class="kanban-column"></div></div>
                </div>
            </div>
        </div>
    </div>

    <div id="printArea" class="hidden p-10">
        <h1 id="printDate" class="text-2xl font-bold mb-6"></h1>
        <table class="w-full border-collapse border border-black text-lg">
            <thead><tr class="bg-slate-100 font-bold">
                <td class="border border-black p-2">Table</td><td class="border border-black p-2">Time</td><td class="border border-black p-2">Guest</td><td class="border border-black p-2">Pax</td><td class="border border-black p-2">Status</td>
            </tr></thead>
            <tbody id="printBody"></tbody>
        </table>
    </div>

    <div id="modal" class="fixed inset-0 bg-slate-900/90 hidden flex items-center justify-center z-50 p-6">
        <div class="bg-white p-10 rounded-[3rem] w-full max-w-[550px] shadow-2xl">
            <h2 class="text-4xl font-black mb-8 text-slate-800 tracking-tighter">Reservation</h2>
            <div class="space-y-6">
                <div class="grid grid-cols-2 gap-4">
                    <input type="time" id="newTime" class="border-2 border-slate-100 p-6 rounded-2xl text-2xl font-bold bg-slate-50">
                    <input type="number" id="newSize" placeholder="PAX" class="border-2 border-slate-100 p-6 rounded-2xl text-2xl font-bold bg-slate-50">
                </div>
                <input type="text" id="newName" placeholder="GUEST NAME" class="w-full border-2 border-slate-100 p-6 rounded-2xl text-2xl font-black outline-none focus:border-blue-500 uppercase">
                <input type="text" id="newPhone" placeholder="PHONE NUMBER" class="w-full border-2 border-slate-100 p-6 rounded-2xl text-2xl font-bold outline-none">
                <textarea id="newReq" placeholder="SPECIAL REQUESTS..." class="w-full border-2 border-slate-100 p-6 rounded-2xl text-xl h-32"></textarea>
                <div class="flex gap-4 pt-4">
                    <button onclick="closeModal()" class="flex-1 py-6 font-bold text-slate-400 text-xl">CANCEL</button>
                    <button onclick="addGuest()" class="flex-1 bg-blue-600 text-white py-6 rounded-3xl font-black text-2xl shadow-xl shadow-blue-100">CONFIRM</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const ids = ['unassigned', 'A1', 'A2', 'A3', 'A6', 'A7', 'A8', 'B1', 'B2', 'B3', 'B4', 'B5'];
        const picker = document.getElementById('datePicker');
        picker.value = new Date().toISOString().split('T')[0];

        ids.forEach(id => {
            new Sortable(document.getElementById(id), { 
                group: 'ipad_v5', 
                animation: 250, 
                delay: 40,
                delayOnTouchOnly: true,
                onEnd: save 
            });
        });

        function openModal() { document.getElementById('modal').classList.remove('hidden'); }
        function closeModal() { document.getElementById('modal').classList.add('hidden'); }

        function toggleStatus(btn) {
            const card = btn.closest('.guest-card');
            const states = ['pending', 'arrived', 'seated'];
            let next = states[(states.indexOf(card.dataset.status) + 1) % states.length];
            card.dataset.status = next;
            card.className = `guest-card p-5 relative group status-${next}`;
            btn.innerText = next.toUpperCase();
            save();
        }

        function addGuest() {
            const data = {
                name: document.getElementById('newName').value || 'GUEST',
                size: document.getElementById('newSize').value || '?',
                time: document.getElementById('newTime').value || '--:--',
                phone: document.getElementById('newPhone').value || '-',
                req: document.getElementById('newReq').value || '',
                status: 'pending'
            };
            renderCard('unassigned', data);
            save();
            closeModal();
            document.querySelectorAll('#modal input, #modal textarea').forEach(i => i.value = '');
        }

        function renderCard(containerId, data) {
            const div = document.createElement('div');
            div.className = `guest-card p-5 relative group status-${data.status}`;
            Object.assign(div.dataset, data);
            div.innerHTML = `
                <div class="flex justify-between items-start">
                    <div class="text-3xl font-black text-blue-600 mr-4">${data.time}</div>
                    <div class="text-3xl font-black text-slate-400">[${data.size}P]</div>
                </div>
                <div class="text-2xl font-black mt-2 uppercase truncate pr-8">${data.name}</div>
                <div class="text-sm font-bold text-slate-400 mt-1">${data.phone}</div>
                <div class="flex gap-2 mt-4">
                    <button onclick="toggleStatus(this)" class="flex-1 py-3 rounded-xl border-2 border-current font-black text-[10px] tracking-widest uppercase">
                        ${data.status}
                    </button>
                    <button onclick="this.parentElement.parentElement.remove(); save();" class="px-4 py-3 rounded-xl bg-slate-100 text-slate-400 font-bold">DELETE</button>
                </div>
                ${data.req ? `<div class="mt-3 p-3 bg-white/50 rounded-xl text-xs font-bold italic border border-black/5">"${data.req}"</div>` : ''}
            `;
            document.getElementById(containerId).appendChild(div);
        }

        function save() {
            const state = {};
            let total = 0;
            ids.forEach(id => {
                const cards = Array.from(document.getElementById(id).querySelectorAll('.guest-card'));
                state[id] = cards.map(c => {
                    total += parseInt(c.dataset.size) || 0;
                    return {...c.dataset};
                });
            });
            const db = JSON.parse(localStorage.getItem('rest_v5') || '{}');
            db[picker.value] = state;
            localStorage.setItem('rest_v5', JSON.stringify(db));
            document.getElementById('totalCovers').innerText = `Total: ${total} Guests`;
            prepPrint();
        }

        function load() {
            const db = JSON.parse(localStorage.getItem('rest_v5') || '{}');
            ids.forEach(id => document.getElementById(id).innerHTML = '');
            const day = db[picker.value];
            if (day) Object.keys(day).forEach(id => day[id].forEach(g => renderCard(id, g)));
            save(); // Updates total counter
        }

        function prepPrint() {
            const body = document.getElementById('printBody');
            document.getElementById('printDate').innerText = "Floor Plan: " + picker.value;
            body.innerHTML = '';
            ids.forEach(id => {
                document.getElementById(id).querySelectorAll('.guest-card').forEach(g => {
                    body.innerHTML += `<tr><td class="border border-black p-2 font-bold">${id}</td><td class="border border-black p-2">${g.dataset.time}</td><td class="border border-black p-2 font-bold">${g.dataset.name}</td><td class="border border-black p-2 text-center">${g.dataset.size}</td><td class="border border-black p-2 uppercase text-xs">${g.dataset.status}</td></tr>`;
                });
            });
        }

        function clearDay() { if(confirm("Clear this day?")) { ids.forEach(id => document.getElementById(id).innerHTML = ''); save(); } }
        picker.addEventListener('change', load);
        window.onload = load;
    </script>
</body>
</html>
